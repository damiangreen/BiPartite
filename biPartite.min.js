-function(){function i(t){function f(n,t,i,r,u){var f=d3.sum(n),e=0,h=0,c=i-t-2*r*n.length,o=[],s;return n.forEach(function(e){var s={};s.percent=f==0?0:e/f;s.value=e;s.height=Math.max(s.percent*(i-t-2*r*n.length),u);s.height==u?c-=u:h+=s.height;o.push(s)}),s=c/Math.max(h,1),e=0,o.forEach(function(o){o.percent=s*o.percent;o.height=o.height==u?u:o.height*s;o.middle=e+r+o.height/2;o.y=t+o.middle-o.percent*(i-t-2*r*n.length)/2;o.h=o.percent*(i-t-2*r*n.length);o.percent=f==0?0:o.value/f;e+=2*r+o.height}),o}var i={};return i.mainBars=[f(t.data[0].map(function(n){return d3.sum(n)}),0,n.options.height,r,u),f(t.data[1].map(function(n){return d3.sum(n)}),0,n.options.height,r,u)],i.subBars=[[],[]],i.mainBars.forEach(function(n,r){n.forEach(function(n,u){f(t.data[r][u],n.y,n.y+n.h,0,0).forEach(function(n,t){n.key1=r==0?u:t;n.key2=r==0?t:u;i.subBars[r].push(n)})})}),i.subBars.forEach(function(n){n.sort(function(n,t){return n.key1<t.key1?-1:n.key1>t.key1?1:n.key2<t.key2?-1:n.key2>t.key2?1:0})}),i.edges=i.subBars[0].map(function(n,t){return{key1:n.key1,key2:n.key2,y1:n.y,y2:i.subBars[1][t].y,h1:n.h,h2:i.subBars[1][t].h}}),i.keys=t.keys,i}function h(n){var t=d3.interpolate(this._current,n);return this._current=t(0),function(n){return e(t(n))}}function f(t,i,r){var f,u;d3.select("#"+i).append("g").attr("class","part"+r).attr("transform","translate("+r*(n.options.transitionWidth+n.options.rectangleWidth)+",0)");f=d3.select("#"+i).select(".part"+r);f.append("g").attr("class","subbars");f.append("g").attr("class","mainbars");u=d3.select("#"+i).select(".part"+r).select(".mainbars").selectAll(".mainbar").data(t.mainBars[r]).enter().append("g").attr("class","mainbar");u.append("rect").attr("class","mainrect").attr("x",0).attr("y",function(n){return n.middle-n.height/2}).attr("width",n.options.rectangleWidth).attr("height",function(n){return n.height});u.append("text").attr("class","barlabel").attr("x",n.options.labelColumn[r]).attr("y",function(n){return n.middle+5}).text(function(n,i){return t.keys[r][i]}).attr("text-anchor","start");u.append("text").attr("class","barvalue").attr("x",n.options.valueColumn[r]).attr("y",function(n){return n.middle+5}).text(function(n){return n.value}).attr("text-anchor","end");u.append("text").attr("class","barpercent").attr("x",n.options.barpercentColumn[r]).attr("y",function(n){return n.middle+5}).text(function(n){return"("+Math.round(100*n.percent)+"%)"}).attr("text-anchor","end");d3.select("#"+i).select(".part"+r).select(".subbars").selectAll(".subbar").data(t.subBars[r]).enter().append("rect").attr("class","subbar").attr("x",0).attr("y",function(n){return n.y}).attr("width",n.options.rectangleWidth).attr("height",function(n){return n.h}).style("fill",function(t){return(t===null||t.key1==null)&&alert("sadfsdf"),n.options.colors[t.key1]})}function c(t,i){d3.select("#"+i).append("g").attr("class","edges").attr("transform","translate("+n.options.rectangleWidth+",0)");d3.select("#"+i).select(".edges").selectAll(".edge").data(t.edges).enter().append("polygon").attr("class","edge").attr("points",e).style("fill",function(t){return n.options.colors[t.key1]}).style("opacity",.5).each(function(n){this._current=n})}function l(t,i){d3.select("#"+i).append("g").attr("class","header").append("text").text(t[2]).attr("x",n.options.headerX).attr("y",n.options.headerY);[0,1].forEach(function(r){var u=d3.select("#"+i).select(".part"+r).append("g").attr("class","header");u.append("text").text(t[r]).attr("x",n.options.labelColumn[r]-5).attr("y",-5);u.append("text").text("Count").attr("x",n.options.valueColumn[r]-10).attr("y",-5);u.append("line").attr("x1",n.options.labelColumn[r]-10).attr("y1",-2).attr("x2",n.options.barpercentColumn[r]+10).attr("y2",-2).attr("class","header-underscore")})}function e(t){return[0,t.y1,n.options.transitionWidth,t.y2,n.options.transitionWidth,t.y2+t.h2,0,t.y1+t.h1].join(" ")}function o(n,t,i){var r=d3.select("#"+t).select(".part"+i).select(".mainbars").selectAll(".mainbar").data(n.mainBars[i]);r.select(".mainrect").transition().duration(500).attr("y",function(n){return n.middle-n.height/2}).attr("height",function(n){return n.height});r.select(".barlabel").transition().duration(500).attr("y",function(n){return n.middle+5});r.select(".barvalue").transition().duration(500).attr("y",function(n){return n.middle+5}).text(function(n){return n.value});r.select(".barpercent").transition().duration(500).attr("y",function(n){return n.middle+5}).text(function(n){return"("+Math.round(100*n.percent)+"%)"});d3.select("#"+t).select(".part"+i).select(".subbars").selectAll(".subbar").data(n.subBars[i]).transition().duration(500).attr("y",function(n){return n.y}).attr("height",function(n){return n.h})}function a(t,i){d3.select("#"+i).append("g").attr("class","edges").attr("transform","translate("+n.rectangleWidth+",0)");d3.select("#"+i).select(".edges").selectAll(".edge").data(t.edges).transition().duration(500).attrTween("points",h).style("opacity",function(n){return n.h1==0||n.h2==0?0:.5})}function s(n,t){o(n,t,0);o(n,t,1);a(n,t)}var t={},r=1,u=14,n=this;this.options={colors:["#3366CC","#DC3912","#FF9900","#109618","#990099","#0099C6"],labelColumn:[-130,40],valueColumn:[-50,100],barpercentColumn:[-10,160],headerX:108,headerY:-20,transitionWidth:250,width:1100,height:610,sortbyKey:!1,margin:{b:0,t:40,l:170,r:50},rectangleWidth:80};t.setOptions=function(t){n.options=t};t.partData=function(t,i){var r={},f=d3.set(t.map(function(n){return n[0]})).values(),u;return n.options.sortbyKey&&(f=f.sort()),u=d3.set(t.map(function(n){return n[1]})).values(),n.options.sortbyKey&&(u=u.sort(d3.descending())),r.keys=[f,u],r.data=[r.keys[0].map(function(){return r.keys[1].map(function(){return 0})}),r.keys[1].map(function(){return r.keys[0].map(function(){return 0})})],t.forEach(function(n){r.data[0][r.keys[0].indexOf(n[0])][r.keys[1].indexOf(n[1])]=n[i];r.data[1][r.keys[1].indexOf(n[1])][r.keys[0].indexOf(n[0])]=n[i]}),r};t.draw=function(r,u){var e=d3.select(u).append("svg").attr("width",n.options.width).attr("height",n.options.height+n.options.margin.b+n.options.margin.t).append("g").attr("transform","translate("+n.options.margin.l+","+n.options.margin.t+")");r.forEach(function(n,u){e.append("g").attr("id",n.id).attr("transform","translate("+550*u+",0)");var o=i(n.data);f(o,n.id,0);f(o,n.id,1);c(o,n.id);l(n.header,n.id);[0,1].forEach(function(i){d3.select("#"+n.id).select(".part"+i).select(".mainbars").selectAll(".mainbar").on("mouseover",function(n,u){return t.selectSegment(r,i,u)}).on("mouseout",function(n,u){return t.deSelectSegment(r,i,u)})})})};t.selectSegment=function(n,t,r){n.forEach(function(n){var u={keys:[],data:[]},f;u.keys=n.data.keys.map(function(n){return n});u.data[t]=n.data.data[t].map(function(n){return n});u.data[1-t]=n.data.data[1-t].map(function(n){return n.map(function(n,t){return r==t?n:0})});s(i(u),n.id);f=d3.select("#"+n.id).select(".part"+t).select(".mainbars").selectAll(".mainbar").filter(function(n,t){return t==r});f.selectAll(".mainrect, .barlabel, .barvalue, .barpercent").classed("selected",!0)})};t.deSelectSegment=function(n,t,r){n.forEach(function(n){s(i(n.data),n.id);var u=d3.select("#"+n.id).select(".part"+t).select(".mainbars").selectAll(".mainbar").filter(function(n,t){return t==r});u.selectAll(".mainrect, .barlabel, .barvalue, .barpercent").classed("selected",!1)})};this.bP=t}();
/*
//# sourceMappingURL=biPartite.min.js.map
*/