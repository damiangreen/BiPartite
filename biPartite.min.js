-function(){function i(t){function r(n,t,i,r,u){var f=d3.sum(n),s=0,h=0,c=i-t-2*r*n.length,e=[],o;return n.forEach(function(o){var s={};s.percent=f==0?0:o/f;s.value=o;s.height=Math.max(s.percent*(i-t-2*r*n.length),u);s.height==u?c-=u:h+=s.height;e.push(s)}),o=c/Math.max(h,1),e.forEach(function(e){e.percent=o*e.percent;e.height=e.height==u?u:e.height*o;e.middle=s+r+e.height/2;e.y=t+e.middle-e.percent*(i-t-2*r*n.length)/2;e.h=e.percent*(i-t-2*r*n.length);e.percent=f==0?0:e.value/f;s+=2*r+e.height}),e}var i={};return i.mainBars=[r(t.data[0].map(function(n){return d3.sum(n)}),0,n.options.height,n.options.rectangleMargin,n.options.minHeight),r(t.data[1].map(function(n){return d3.sum(n)}),0,n.options.height,n.options.rectangleMargin,n.options.minHeight)],i.subBars=[[],[]],i.mainBars.forEach(function(n,u){n.forEach(function(n,f){r(t.data[u][f],n.y,n.y+n.h,0,0).forEach(function(n,t){n.key1=u==0?f:t;n.key2=u==0?t:f;i.subBars[u].push(n)})})}),i.subBars.forEach(function(n){n.sort(function(n,t){return n.key1<t.key1?-1:n.key1>t.key1?1:n.key2<t.key2?-1:n.key2>t.key2?1:0})}),i.edges=i.subBars[0].map(function(n,t){return{key1:n.key1,key2:n.key2,y1:n.y,y2:i.subBars[1][t].y,h1:n.h,h2:i.subBars[1][t].h}}),i.keys=t.keys,i}function o(n){var t=d3.interpolate(this._current,n);return this._current=t(0),function(n){return u(t(n))}}function r(i,r,u){var e,f;d3.select("#"+r).append("g").attr("class","part"+u).attr("transform","translate("+u*(n.options.transitionWidth+n.options.rectangleWidth)+",0)");e=d3.select("#"+r+" .part"+u);e.append("g").attr("class","subbars");e.append("g").attr("class","mainbars");f=t.selectMainBars(r,u).data(i.mainBars[u]).enter().append("g").attr("class","mainbar");u===1&&f.append("rect").attr("class","mainrect-container").attr("x",n.options.rectangleWidth).attr("y",function(n){return n.middle-n.height/2}).attr("width",n.options.header.barpercentColumn[u]-n.options.rectangleWidth+10).attr("height",function(n){return n.height});f.append("rect").attr("class","mainrect").attr("x",0).attr("y",function(n){return n.middle-n.height/2}).attr("width",n.options.rectangleWidth).attr("height",function(n){return n.height});f.append("text").attr("class","barlabel").attr("x",n.options.header.labelPosition[u]).attr("y",function(n){return n.middle+5}).text(function(n,t){return i.keys[u][t]}).attr("text-anchor","start");f.append("text").attr("class","barvalue").attr("x",n.options.header.valuePosition[u]).attr("y",function(n){return n.middle+5}).text(function(n){return n.value}).attr("text-anchor","end");f.append("text").attr("class","barpercent").attr("x",n.options.header.barpercentColumn[u]).attr("y",function(n){return n.middle+5}).text(function(n){return"("+Math.round(100*n.percent)+"%)"}).attr("text-anchor","end");t.selectSubBars(r,u).data(i.subBars[u]).enter().append("rect").attr("class","subbar").attr("x",0).attr("y",function(n){return n.y}).attr("width",n.options.rectangleWidth).attr("height",function(n){return n.h}).style("fill",function(t){return(t===null||t.key1==null||t.key1>5)&&alert("sadfsdf"),n.options.colors[t.key1]})}function s(t,i){d3.select("#"+i).append("g").attr("class","edges").attr("transform","translate("+n.options.rectangleWidth+",0)");d3.select("#"+i+" .edges").selectAll(".edge").data(t.edges).enter().append("polygon").attr("class","edge").attr("points",u).style("fill",function(t){return n.options.colors[t.key1]}).style("opacity",n.options.transitionOpacity).each(function(n){this._current=n})}function h(t,i){d3.select("#"+i).append("g").attr("class","header").append("text").text(t[2]).attr("x",n.options.header.position[0]).attr("y",n.options.header.position[1]);[0,1].forEach(function(r){var u=d3.select("#"+i+" .part"+r).append("g").attr("class","header");u.append("text").text(t[r]).attr("x",n.options.header.labelPosition[r]-5).attr("y",-5);u.append("text").text("Count").attr("x",n.options.header.valuePosition[r]-10).attr("y",-5);u.append("line").attr("x1",n.options.header.labelPosition[r]-10).attr("y1",-2).attr("x2",n.options.header.barpercentColumn[r]+10).attr("y2",-2).attr("class","header-underscore")})}function u(t){return[0,t.y1,n.options.transitionWidth,t.y2,n.options.transitionWidth,t.y2+t.h2,0,t.y1+t.h1].join(" ")}function f(i,r,u){var f=t.selectMainBars(r,u).data(i.mainBars[u]);f.select(".mainrect").transition().duration(n.options.duration).attr("y",function(n){return n.middle-n.height/2}).attr("height",function(n){return n.height});f.select(".barlabel").transition().duration(n.options.duration).attr("y",function(n){return n.middle+5});f.select(".barvalue").transition().duration(n.options.duration).attr("y",function(n){return n.middle+5}).text(function(n){return n.value});f.select(".barpercent").transition().duration(n.options.duration).attr("y",function(n){return n.middle+5}).text(function(n){return"("+Math.round(100*n.percent)+"%)"});t.selectSubBars(r,u).data(i.subBars[u]).transition().duration(n.options.duration).attr("y",function(n){return n.y}).attr("height",function(n){return n.h})}function c(t,i){d3.select("#"+i).append("g").attr("class","edges").attr("transform","translate("+n.options.rectangleWidth+",0)");d3.select("#"+i).select(".edges").selectAll(".edge").data(t.edges).transition().duration(n.options.duration).attrTween("points",o).style("opacity",function(n){return n.h1==0||n.h2==0?0:.5})}function e(n,t){f(n,t,0);f(n,t,1);c(n,t)}var t={},n=this;this.options={colors:["#ef5464","#f36d54","#6798d0","#ffcf56","#5bc2a7","#ea88b9","#e7eaef"],header:{position:[108,-20],labelPosition:[-130,40],valuePosition:[-50,100],barpercentColumn:[-10,160]},transitionWidth:250,width:1100,height:610,sortbyKey:!1,margin:{b:0,t:40,l:170,r:50},rectangleWidth:80,minHeight:14,rectangleMargin:0,transitionOpacity:.5,duration:500};t.setOptions=function(t){if(t===null||typeof t!="object")throw"options is not an object";t.colors instanceof Array&&(n.options.colors=t.colors);t.header.labelPosition instanceof Array&&(n.options.header.labelPosition=t.header.labelPosition);t.header.valuePosition instanceof Array&&(n.options.header.valuePosition=t.header.valuePosition);t.header.barpercentColumn instanceof Array&&(n.options.header.barpercentColumn=t.header.barpercentColumn);t.header.position instanceof Array&&(n.options.header.position=t.header.position);typeof t.transitionWidth=="number"&&(n.options.transitionWidth=t.transitionWidth);typeof t.width=="number"&&(n.options.width=t.width);typeof t.height=="number"&&(n.options.height=t.height);typeof t.sortbyKey=="boolean"&&(n.options.sortbyKey=t.sortbyKey);typeof t.margin=="object"&&(n.options.margin=t.margin);typeof t.rectangleWidth=="number"&&(n.options.rectangleWidth=t.rectangleWidth);typeof t.minHeight=="number"&&(n.options.minHeight=t.minHeight);typeof t.rectangleMargin=="number"&&(n.options.rectangleMargin=t.rectangleMargin);typeof t.transitionOpacity=="number"&&(n.options.transitionOpacity=t.transitionOpacity);typeof t.duration=="number"&&(n.options.duration=t.duration)};t.partData=function(t,i){var r={},f=d3.set(t.map(function(n){return n[0]})).values(),u;return n.options.sortbyKey&&(f=f.sort()),u=d3.set(t.map(function(n){return n[1]})).values(),n.options.sortbyKey&&(u=u.sort(d3.descending())),r.keys=[f,u],r.data=[r.keys[0].map(function(){return r.keys[1].map(function(){return 0})}),r.keys[1].map(function(){return r.keys[0].map(function(){return 0})})],t.forEach(function(n){r.data[0][r.keys[0].indexOf(n[0])][r.keys[1].indexOf(n[1])]=n[i];r.data[1][r.keys[1].indexOf(n[1])][r.keys[0].indexOf(n[0])]=n[i]}),r};t.draw=function(u,f){var e=d3.select(f).append("svg").attr("class","bipartite").attr("width",n.options.width).attr("height",n.options.height+n.options.margin.b+n.options.margin.t).append("g").attr("transform","translate("+n.options.margin.l+","+n.options.margin.t+")");u.forEach(function(n,f){e.append("g").attr("id",n.id).attr("transform","translate("+550*f+",0)");var o=i(n.data);r(o,n.id,0);r(o,n.id,1);s(o,n.id);h(n.header,n.id);[0,1].forEach(function(i){t.selectMainBars(n.id,i).on("mouseover",function(n,r){return t.selectSegment(u,i,r)}).on("mouseout",function(n,r){return t.deSelectSegment(u,i,r)})})})};t.selectMainBars=function(n,t){return d3.select("#"+n+" .part"+t+" .mainbars").selectAll(".mainbar")};t.selectSubBars=function(n,t){return d3.select("#"+n+" .part"+t+" .subbars").selectAll(".subbar")};t.selectSegment=function(n,r,u){n.forEach(function(n){var f={keys:[],data:[]},o;f.keys=n.data.keys.map(function(n){return n});f.data[r]=n.data.data[r].map(function(n){return n});f.data[1-r]=n.data.data[1-r].map(function(n){return n.map(function(n,t){return u==t?n:0})});e(i(f),n.id);o=t.selectMainBars(n.id,r).filter(function(n,t){return t==u});o.classed("selected",!0)})};t.deSelectSegment=function(n,r,u){n.forEach(function(n){e(i(n.data),n.id);var f=t.selectMainBars(n.id,r).filter(function(n,t){return t==u});f.classed("selected",!1)})};this.biPartiteChart=t}();
/*
//# sourceMappingURL=biPartite.min.js.map
*/